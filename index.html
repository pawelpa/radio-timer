<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Radio Timer</title>
    </head>
    <body>
        <h3>RMF Classic audio player</h3>
        Setup automatic turn off after:
        <form id="timer">
            <label for="inputHour">Hours:</label>
            <input
                type="number"
                name="hour"
                id="inputHour"
                style="width: 35px"
                value=""
            />
            <label for="inputMinute">Minutes:</label>
            <input
                type="number"
                name="minute"
                id="inputMinute"
                style="width: 35px"
                value=""
                required
            />
            <input type="submit" value="Set" />
        </form>
        <br />
        <br />
        <select id="station">
            <option value="https://rs202-krk-cyfronet.rmfstream.pl/RMF5">
                Spokojne przeboje
            </option>
            <option
                selected
                value="https://rs202-krk-cyfronet.rmfstream.pl/RMFCLASSIC48"
            >
                RMF Classic
            </option>
        </select>
        <br />
        <br />
        <audio id="radio" controls></audio>
        <!-- timer status -->
        <div>
            Remaining time to stop playing: <span id="hour">00</span>:<span
                id="minute"
                >00</span
            >:<span id="secound">00</span>
        </div>
        <!-- script -->
        <script>
            let interval;
            const url = "https://rs202-krk-cyfronet.rmfstream.pl/RMFCLASSIC48";
            const radio = document.getElementById("radio");
            const station = document.getElementById("station");
            radio.src = url;

            //set innerText on dom element
            function setText(element, value) {
                if (+value <= 9) {
                    element.innerText = "0" + value;
                } else {
                    element.innerText = value;
                }
            }
            //get dom elemet innerText as integer value
            function getElInt(element) {
                return parseInt(element.innerText);
            }
            station.addEventListener("change", (e) => {
                //set radio element src attribute to selected url
                radio.src =
                    e.target.options[e.target.options.selectedIndex].value;
                radio.play();
            });

            timer.addEventListener("submit", (e) => {
                e.preventDefault();

                clearInterval(interval);

                let hour = document.getElementById("hour");
                let minute = document.getElementById("minute");
                let secound = document.getElementById("secound");

                //setup timer to given time
                setText(hour, e.target.inputHour.value || 0);
                setText(minute, e.target.inputMinute.value || 0);
                setText(secound, 5);

                if (!getElInt(hour) && !getElInt(minute) && !getElInt(secound))
                    return;

                //run interval every 1 secound
                interval = setInterval(function () {
                    setText(secound, getElInt(secound) - 1);

                    if (getElInt(secound) === 0 && getElInt(minute) > 0) {
                        setText(minute, getElInt(minute) - 1);
                        setText(secound, 59);
                    } else if (
                        getElInt(secound) === 0 &&
                        getElInt(minute) === 0 &&
                        getElInt(hour) > 0
                    ) {
                        setText(hour, getElInt(hour) - 1);
                        setText(minute, 59);
                        setText(secound, 59);
                    } else if (
                        /* timer stopped */
                        getElInt(hour) === 0 &&
                        getElInt(minute) === 0 &&
                        getElInt(secound) === 0
                    ) {
                        clearInterval(interval);
                        radio.pause();
                        console.log("audio paused");
                    }
                }, 1000);
            });
        </script>
    </body>
</html>
